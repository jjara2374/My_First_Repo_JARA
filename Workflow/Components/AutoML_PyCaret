import pycaret.classification as pc
import pandas as pd
from airflow import DAG
from airflow.operators.python_operator import PythonOperator
from datetime import datetime

def automl_pycaret():
    # Cargar el dataset
    df = pd.read_csv('train.csv')
    
   setup = pc.setup(data=df, target='target_column_name', silent=True, verbose=False)
    
    # Comparar modelos y seleccionar el mejor
    best_model = pc.compare_models()
    
    # Guardar el mejor modelo
    pc.save_model(best_model, '/Machine/model_pycaret')

# Definir el DAG de Airflow
dag = DAG('AutoML_PyCaret', description='Run AutoML with PyCaret',
          schedule_interval='@once', start_date=datetime(2024, 10, 13))


automl_task = PythonOperator(
    task_id='automl_task',
    python_callable=automl_pycaret,
    dag=dag
)

